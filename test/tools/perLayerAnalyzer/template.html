<html>
<head>
  <style type="text/css">
  table {
  border: 1px solid black;
  border-collapse: collapse;
  }
  td,th {
  border: 1px solid black;
  }
  </style>
  <meta charset="utf-8">
  <title>WebML Polyfill | Mocha Tests</title>
  <link href='./static/mocha/3.0.2/mocha.css' rel='stylesheet'>
</head>
<body>
  <p id = "avg" style="display:none"></p>
  <div id = "result" style="display:none">
    <p id = "iterations">Iterations: 1(warming up) + </p>
    <table>
      <tr>
      <th>Layer</th>
      <th>Model_name</th>
      <th>Ops</th>
      <th>Avg_time</th>
      <th>Bias</th>
      <th>Weight</th>
      <th>Input_dimensions</th>
      <th>Output_dimensions</th>
      <th>Stride</th>
      <th>Filter</th>
      <th>Padding</th>
      <th>Activation</th>
      <th>Axis</th>
      <th>ShapeLen</th>
      <th>ShapeValues</th>
      </tr>
    </table> 
  </div>
  <div id = "mocha"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/4.0.1/mocha.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.1.2/chai.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
  <script src="../dist/webml-polyfill.js"></script>
  <script src="./utils.js"></script>
  <script>
    setOptions();
  </script>
  <script>
    mocha.setup('bdd');
  </script>

  <!-- Add some real-model-test-case here -->
  <!-- <script src="<real-model-test-case-js-file>"></script> -->

 <script>
    mocha.globals(['jQuery']);
    mocha.run(function() {
      document.getElementById("avg").insertAdjacentText("beforeend","]");
      document.getElementById("avg").insertAdjacentText("afterbegin","[");
      var obj = document.getElementById("avg");
      avg_text = obj.innerHTML;
      console.log(avg_text);
      let avg_data = JSON.parse(avg_text);
      setTimeout(() => {
        console.log(avg_data);
        var table = document.getElementsByTagName ('table')[0];
        console.log(avg_data.length);
        for(var i = 0; i < avg_data.length; i++) {
          var tr = table.insertRow (table.rows.length);
          var obj = avg_data[i];
          for(var p in obj) {
            if(p == 'tenancy') {
              break;
            }
            var td = tr.insertCell (tr.cells.length);
            td.innerText = obj[p];
          }
        };
      }, 300);
      var reg = new RegExp("(^|&)prefer=([^&]*)&iterations=([^&]*)&API=([^&]*)&platform=([^&]*)&supportSwitch=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) {
        var prefer = unescape(r[2]).toLowerCase();
        var iterations = unescape(r[3]).toLowerCase();
        var API = unescape(r[4]).toLowerCase();
        var testPlatform = unescape(r[5])
        var supportSwitch = unescape(r[6]).toLowerCase();
      }
      console.log(prefer);
      document.getElementById("iterations").insertAdjacentText("beforeend",iterations);
      document.getElementById("result").style.display = "block";

    if (supportSwitch === "true") {
      if (testPlatform === "Mac" && API === "webnn" && prefer==="fast") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'MKLDNN');
      };
      if (testPlatform === "Windows" && API === "webnn" && prefer==="sustained") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'DML');
      };
      if (testPlatform === "Windows" && API === "webnn" && prefer==="low") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'DML');
      };
      if (testPlatform === "Linux" && API === "webnn" && prefer==="fast") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'IE-MKLDNN');
      };
      if (testPlatform === "Linux" && API === "webnn" && prefer==="sustained") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'IE-clDNN');
      };
      if (testPlatform === "Linux" && API === "webnn" && prefer==="low") {
        document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform + ' / ' + API + ' / ' + prefer + ' / ' + 'IE-MYRIAD');
      };
  } else {
    document.getElementById("testPlatform").insertAdjacentText("beforeend",testPlatform +' / '+ API +' / '+ prefer);
  }
    });
  </script>
  
</body>
</html>